# CPU 스케줄링이란?
프로세스가 작업을 수행할 때, 언제 어떤 프로세스에 CPU를 할당할지를 결정하는 작업이다.


### 스케줄링 기준 
스케줄링이란, 수 많은 프로세스들을 어떤 순서로 정렬할지 정책을 수립하는 것이다. 스케줄링 기준에는 여러가지가 있다.
- CPU 활용률 (Utilization): 전체 시스템 시간 중 CPU가 작업을 처리하는 시간의 비율이다. CPU가 쉬고 있지 않게 해야 한다.
- 처리량(Throughput): 단위 시간 당 처리량으로 1초당 처리하는 프로세스의 갯수이다.
- 응답 시간(Response Time): 요청한 후 응답이 올 때까지 걸린 시간
- 대기 시간(Waiting Time): 수행을 요청한 후 작업이 시작될 때까지 걸린 시간 (Ready Queue에서 대기하는 시간의 총합)
- Turnaround Time: 프로세스가 시작해서 끝날 때까지 걸리는 시간


**CPU Utilitzation, Throughput은 늘리고, Time 지표들은 감소하는 것이 스케줄링 목표가 된다.**

## 스케줄링 역할에 의한 구분
#### 1. 장기 스케줄러 (Long term scheduler)
- 가장 큰 틀에서 이루어지는 CPU 스케줄러로, 상위 스케줄러, 작업 스케줄러라고 한다.
- 장기스케줄러는 프로세스의 활성화 승인을 다룬다. 어떤 프로세스를 준비 큐에 넣을지 결정하는 역할을 한다.
- 전체 시스템의 부하를 고려하여 작업 요청을 받아들일지, 거부할지에 대한 결정을 한다.메인 메모리에 적재된 프로세스 양을 판단하여 조절한다.
- 장기 스케줄러의 결정에 따라 시스템 내의 프로세스 총 개수가 정해진다.(멀티프로그래밍의 정도를 결정)
- 최근 운영체제에서는 보통 장기 스케줄러가 없다. 프로그램을 실행시키면 곧바로 ready 상태로 돌입한다.


#### 2. 중기 스케줄러 (Medium term scheduler, Swapper)
- 이미 활성화 된 프로세스들에 대한 관리를한다. 메모리에 적재된 프로세스의 수를 동적으로 조절하기 위해 추가된 스케줄러이다.
- 시스템 과부하를 막기 위해 활성화된 프로세스들의 중지 여부를 결정하여 활성화된 프로세스 수를 조절한다.메모리에 적재 된 프로세스 총 갯수를 제어하는 것이다.
- Swapping 기법으로 현재 메모리에 적재되어 있는 프로세스들을 중재하여 일시 보류&재활성화 한다.
	- 메모리에서 디스크로 나가는 상태 (Swap Out)
	- 디스크에서 메모리로 들어오는 상태 (Swap In)
- 중기 스케줄러에 의해 중지된 프로세스들은 보류 상태(Suspended, Stopped)가 된다.
- CPU와 메모리 사이의 스케줄링을 담당한다.
#### 3. 단기 스케줄러 (Short term scheduler, CPU scheduler)
- 가장 작은 단위의 스케줄러, 프로세스 스케줄러, CPU 스케줄러
- ready 상태의 프로세스 중에서 어떤 프로세스를 다음 번에 실행 상태로 만들 것인지 결정한다.
- 미리 정한 스케줄링 알고리즘에 따라 CPU에 할당 할 프로세스를 선택한다.
- 단기 스케줄러가 어떤 기준에 따라 프로세스를 선택(스케줄링 알고리즘)하고, 어느정도 자원을 배분(Time sclice)할지에 따라 시스템에 큰 영향을 끼칩니다. 
- 수행 속도가 빨라야 한다.

#### 정리
- 장기 스케줄링은 어떤 프로세스를 준비 큐에 넣을것인가를 결정한다.
- 중기 스케줄링은 메모리에 적재된 프로세스 수를 관리한다.
- 단기 스케줄링은 어떤 프로세스에게 CPU를 할당해줄 것인가를 결정한다.
![](https://velog.velcdn.com/images/soyeong125/post/e2535e73-66b8-4e11-b95d-3a306bb2594f/image.png)

## CPU 스케줄링의 필요성
CPU를 효율적으로 사용하기 위해 프로세스들을 잘 배정해야한다. 또 모든 프로세스가 적당히 공평하게 자원을 할당받도록 해야한다. Ready Queue에 있는 프로세스 대상으로 CPU를 할당하는 순서와 방식을 결정하는 것을 의미한다.

## 스케줄링 시 고려사항
CPU를 효율적으로 사용하고, 모든 프로세스가 공평하게 자원을 할당받기 위해서 고려해야할 점이있다.

#### 1) 선점형 스케줄링과 비선점형 스케줄링
선점이란, "빼앗을 수 있음"을 말한다. 즉, 선점 스케줄링, 비선점 스케줄링 방식은 어떤 프로세스가 CPU를 할당받으면 이를 운영체제가 강제로 회수할 수 있는 스케줄링 방식인지, 아닌지에 대한 내용이다.

1. 선점형 스케줄링
	-  운영체제가 필요하다고 판단되면 실행상태에 있는 작업을 중단시키고 새로운 작업을 시작할 수 있다. time out상황이나, I/O interrupt, System call등이 발생하면 현재 실행 상태에 있는 프로세스의 CPU를 강제로 회수하고 다른 프로세스에게 CPU를 할당해줄 수 있는 스케줄링 방식
    - Context switch 로 인한 오버헤드가 발생한다. 그러니 하나의 프로세스가 CPU를 독점한다는 것은 동시에 여러 작업을 할 수 없다는 의미이므로 대부분 스케줄러는 선점형 스케줄링 방식을 사용한다.
    
2. 비선점형 스케줄링
	- 어떤 프로세스가 실행 상태에 들어가면 그 프로세스가 끝나거나 CPU를 자진 반납하는 경우가 아니면 계속 실행되는 것
    - Context switch에 대한 오버헤드도 없고 스케줄러가 할 일도 적어져 효율적일 수 있으나 전체 시스템 처리율이 떨어지게 된다.

#### 2) 프로세스 우선순위

프로세스간에도 우선순위가 있다. 프로세스는 **커널 프로세스**와 **일반 프로세스**로 나뉘는데, CPU 스케줄러는 보통 커널 프로세스를 높은 우선순위에 둔다.
#### 3) CPU bound Process와 IO bound Process
**IO bound Process** 의 우선순위를 **CPU bound Process** 보다 높이는 것이 시스템 효율 향상에 도움이 된다.

프로세스는 여러 상태가 있다. 이때 **실제 작업이 일어나는 것은 CPU를 사용하는 "실행 상태"**와 **입출력을 요청하여 완료되기를 기다리는 "대기 상태"**가 있다. CPU를 할당받아 실행하는 작업을 **CPU 버스트**, 입출력 작업을 **I/O 버스트**라고 한다.

CPU 버스트가 많은 프로세스를 **CPU bound Process**
I/O 버스트가 많은 프로세스를 **IO bound Process** 라고 한다.</br>
두 프로세스가 있다면 IO bound Process를 먼저 실행 상태로 옮기는 것이 효율적이다. 왜냐면 CPU를 할당받아도 금방 다시 대기 상태로 빠지기 때문이다. 
#### 4) 전면프로세스와 후면 프로세스
전면 프로세스란, GUI를 사용하는 OS에서 화면 맨 앞에 놓인 프로세스를 말한다. (지금 내 상태를 보면 브라우저가 전면 프로세스) 전면 프로세스는 입출력을 사용하는 프로세스이고, 사용자와 상호작용이 가능하다. 하지만 후면 프로세스는 사용자와 상호작용이 없다.

그래서 두 프로세스 중 사용자와 상호작용이 있는 전면 프로세스에 더 높은 우선순위를 준다.



# Dispatcher
- CPU 스케줄링 알고리즘에 의해 새롭게 선택된 프로세스가 CPU를 할당받고 작업을 수행할 수 있도록 환경을 설정하는 커널 모듈이다.
- CPU 스케쥴러, 단기 스케쥴러 내부에 포함된 것으로 단기 스케쥴러가 선택한 프로세스에 실질적으로 프로세스를 할당하는 역할을 한다.
- 현재 수행중이던 Process의 Context를 PCB에 저장하고 새롭게 선택된 Process의 Context를 PCB로부터 복원한 후 그 프로세스에게 CPU를 넘기는 과정을 수행한다.
- Dispatcher가 하나의 프로세스를 정지시키고 다른 프로세스에게 CPU를 전달하기 까지 걸리는 시간을 Dispatcher latency라고 한다. 디스패치 지연시간의 대부분은 문맥교환 오버헤드에 해당한다. 


>출처 </br>
>https://devowen.com/234 </br>
>https://kjhoon0330.tistory.com/entry/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-CPU-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%A7%81 </br>
>https://steady-coding.tistory.com/509 </br>
>https://jihyeong-ji99hy99.tistory.com/26 </br>
>https://kosaf04pyh.tistory.com/191 </br>

