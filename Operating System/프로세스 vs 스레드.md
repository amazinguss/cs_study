### 📌 프로세스란?
---
- 프로세스는 프로그램이 실행해 **정적인 프로그램이 동적으로 변해 프로그램이 돌아가고 있는 상태**를 말한다.
- **작업 중인 프로그램**을 말한다.
- 프로그램은 파일이 **저장 장치**에 있지만 **메모리에는 올라가 있지 않은 정적인 상태**를 말하며 프로세스는 **메모리에 적재**되고 **CPU 자원을 할당받아 프로그램이 실행**되고 있는 상태를 말한다.
  - 모든 프로그램은 운영체제가 실행되기 위한 메모리 공간을 할당해 줘야 실행할 수 있다.
 
<br>
   
> ### ✍️ 프로세스의 자원 구조
> ![](https://gmlwjd9405.github.io/images/os-process-and-thread/process.png)
> - **프로세스는 stack, heap, data, text 네 가지 메모리 영역으로 구성되어 할당받게 된다.**
> 
> <br>
>
> ![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbd8jlQ%2FbtrcRpf0Z4e%2FAZe94zNlREpkAZ260P0W7k%2Fimg.png)
> - 코드 영역 (code/text)
>   - CPU가 해석 가능한 기계어 형태(0, 1)로 코드가 저장되어 있다.
>   - 실행 파일을 구성하는 명령어들이 올라가는 메모리 영역으로 **함수, 제어문, 상수** 등이 여기에 지정된다.
>   - CPU가 코드 영역의 명령어들을 가지고 가 실행한다.
> - 데이터 영역 (data)
>   - 코드 실행 시 사용하는 전역 변수나 static 변수가 있다. 
>   - 데이터 영역은 .data, .BSS, .rodata 영역으로 세분화된다.
>   - main 함수 전에 선언돼 프로그램 시작과 동시에 할당되고 프로그램이 종료되어야 메모리에서 소멸된다.
> - 힙 영역 (heap)
>   - 생성자, 인스턴스와 같은 동적으로 할당된 변수가 할당되는 영역이다.
>   - 사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다.
>   - 할당된 변수가 삭제되면 메모리는 힙으로 반환되고 다시 할당될 수 있다. 즉, 포인터를 삭제하면 변수가 삭제되는 게 아니라 관련 주소의 메모리를 운영 체제에 반환하는 것이다.
>   - 영역 중 유일하게 런타임 시 크기가 결정된다.
> - 스택 영역 (stack)
>   - 지역 변수, 매개 변수와 같은 호출한 함수가 종료되면 되돌아올 자료를 저장하는 독립적인 공간이다.
>   - 함수 호출과 함께 할당되며 완료와 동시에 소멸한다.
>   - stack 영역에 초과되면 stack overflow 오류가 발생한다.
> - **스택 영역과 힙 영역은 프로세스 실행되는 동안 크기가 늘었다 줄었다 하는 동적 영역**이다.



<br>

### 📌 스레드란?
---
- **하나의 프로세스 내에서 동시에 진행되는 작업 갈래, 흐름의 단위**를 말한다.
- 스레드는 동일한 프로그램을 **여러 개의 프로세스로 만들게 되면 메모리 차지가 커지고 CPU에서 할당받는 자원이 중복되는 특성의 한계를 해결**하기 위해 만들어졌다.
- 한 브라우저를 실행했을 때 우리는 브라우저 내에서 다운로드도 하고, 쇼핑도 하고, 게임도 할 수 있다.
- 이런 **작업 흐름**들을 **스레드**라고 하고, 스레드가 여러 개 있다면 **멀티(다중) 스레드**라고 부른다.
- 하나의 프로그램은 하나 이상의 프로세스를 가지고, 하나의 프로세스는 반드시 하나 이상의 스레드를 가진다.
- 프로세스를 생성 시 기본적으로 하나의 스레드(main)가 생성되고, 그 외 스레드는 개발자가 프로그래밍 해 주어야 한다.
 
<br>
   

> ### ✍️ 스레드의 자원 구조
> ![](https://gmlwjd9405.github.io/images/os-process-and-thread/thread.png)
> - 스레드는 프로세스가 할당받은 자원을 이용하는 실행 단위이다.
> - 프로세스의 자원을 공유하며 프로세스 실행의 일부가 되기 때문에 동시 작업이 가능하다.
> - 하나의 프로세스 내에 여러 개의 스레드가 들어 있는 상태이다.
> <br>
> ![](https://blog.kakaocdn.net/dn/c6hP8P/btr5A5vOmq1/lc1Ya3NafKtUsg6s10SCIK/img.png)
>
> - 스레드는 프로세스 내에서 각각 Stack만 따로 할당받고 Code, Data, Heap 영역은 공유한다. 
> - 그래서 각각 스레드는 별도의 stack은 가지고 있지만 heap 메모리는 고유하기 때문에 서로 다른 스레드에서 가지고 와 읽고 쓸 수 있다.
> - stack은 함수 호출 시 전달되는 인자, 되돌아갈 주소 값, 함수 내에서 선언하는 변수 등을 저장하는 메모리 공간이기 때문에 독립적인 스택을 가지고 있다는 것은 독립적인 실행 흐름을 가질 수 있다는 뜻이다.
> - 프로세스는 다른 프로세스의 메모리에 직접 접근이 불가하지만 스레드는 자원을 공유하고 있기 때문에 가능하다.
> - 자원의 생성과 관리 중복성을 최소화하고 수행 능력을 높여 준다.


<br>

### 📌 멀티 프로세스 vs 멀티 스레드 
---
- 멀티 프로세싱은 하나의 응용 프로그램을 여러 개의 프로세스로 구성해 각 프로세스가 하나의 작업을 처리하도록 하는 것이다.
- 멀티 스레딩은 하나의 응용 프로그램을 여러 개의 스레드로 구성해 각 스레드가 하나의 작업을 처리하도록 하는 것이다.
- 대부분의 운영 체제가 멀티 프로세싱을 지원하고 있지만 기본은 멀티 스레딩을 한다.
- 웹 서버는 멀티 스레드 응용 프로그램이다.
  
| |멀티 프로세스|멀티 스레드|
|---|:---|:---|
|장점|- 여러 개의 자식 프로세스 중 하나에 문제가 발생하면 자식 프로세스만 죽고 더 확산되지 않는다.|- 시스템 자원 소모가 감소된다. (자원을 할당하는 시스템 콜이 줄어들기 때문에) <br> - 스레드 간 데이터를 주고받는 게 간단해지고 시스템의 자원 소모가 줄어든다. 즉, 시스템 처리 비용이 감소한다. <br> - 간단한 통신 방법으로 프로그램 응답 시간을 단축할 수 있다. (stack 영역 제외 메모리 공유)|
|단점|- CPU에서 여러 프로세스를 돌아가며 작업을 처리하는 과정(Context Switching)에서 캐쉬 메모리 초기화 등 무거운 작업이 진행되고 많은 시간이 소모된다. <br> - 프로세스 사이의 통신 기술이 복잡하고 어렵다. (IPC, LPC, 별도의 공유 메모리 사용 등) | - 주의 깊은 설계가 필요하다. <br> - 디버깅이 까다롭다. <br> - 단일 프로세스 시스템의 경우 효과를 기대하기 어렵다. <br> - 다른 프로세스에서 스레드를 제어할 수 없다. (프로세스 밖에서는 스레드 제어 불가) <br> - 자원 공유의 문제가 발생할 수 있다. <br> - 하나의 스레드에 문제가 발생하면 전체 프로세스가 영향을 받는다.|
<br>
<br>

### 📌 멀티 스레드를 멀티 프로세스 대신 사용하는 이유는 무엇일까?
---
- 여러 프로세스로 할 수 있는 작업을 여러 스레드로 나누어서 하게 되면 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어든다.
- 프로세스 간의 Context Switching 시 단순히 CPU 레지스터 교체 뿐 아니라 RAM과 CPU 사이의 캐쉬 메모리에 대한 데이터까지 초기화되므로 오버헤드가 크다.
- 프로세스 내의 메모리를 공유하기 때문에 스레드 간 데이터를 주고받는 방법이 간단하고, 시스템 자원 소모가 줄어든다.
- 프로세스 간 통신보다 스레드 간 통신의 비용이 적어 작업들 간 통신 부담이 줄어든다.
- 프로세스 간 전환 속도보다 스레드 간 전환 속도가 빠르다. (Context Switching 시 스레드는 stack 영역만 처리하기 때문)
