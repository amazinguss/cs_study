# μΈν„°λ½νΈλ€?
- CPUκ°€ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ν•κ³  μμ„ λ–„, μ…μ¶λ ¥ ν•λ“μ›¨μ–΄ λ“±μ μ¥μΉμ— μμ™Έμƒν™©μ΄ λ°μƒν•μ—¬ μ²λ¦¬κ°€ ν•„μ”ν• κ²½μ° CPU μ—κ² μ•λ ¤ μ²λ¦¬ν•  μ μλ„λ΅ ν•λ” κΈ°μ 
- μ°μ„ μ μΌλ΅ μ²λ¦¬ν•΄μ•Όν•  μΌμ΄ λ°μƒν–μ„ λ• κ·Έκ²ƒμ„ μ²λ¦¬ν•κ³  μ›λ λ™μ‘μΌλ΅ λμ•„μ¨λ‹¤.


# μΈν„°λ½νΈ μΆ…λ¥
## ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ
- μΌλ°μ μΌλ΅ μΈν„°λ½νΈλ¥Ό μ΄λ¥΄λ” λ§
- CPU μ™Έλ¶€λ΅λ¶€ν„° μΈν„°λ½νΈ μ”κµ¬ μ‹ νΈμ— μν•΄ λ°μƒλλ” μΈν„°λ½νΈ
- Maskable interrupt, Non-maskable interrupt κ°€ μλ‹¤. (Interrunpt Maskκ°€ κ°€λ¥)
    - Maskable interrupt
       - Interrupt Mask(μΈν„°λ½νΈκ°€ λ°μƒν•μ€μ„ λ• μ”κµ¬λ¥Ό λ°›μ•„λ“¤μΌμ§€ λ§μ§€ μ§€μ •ν•λ” κ²ƒ)κ°€ κ°€λ¥
       - μΈν…”CPU μ—μ„ INTR pinμΌλ΅ μ‹ νΈκ°€ λ“¤μ–΄μ΄
       - μ…μ¶λ ¥ μ¥μΉκ°€ μ κΈ°ν•λ” μΈν„°λ½νΈ μ”μ²­κ³Ό λ€λ¶€λ¶„μ μΈν„°λ½νΈκ°€ μ—¬κΈ°μ— ν•΄λ‹Ήν•λ‹¤.
    - Non Maskable interrupt
       - Interrupt Maskκ°€ λ¶κ°€λ¥
       - κ±°λ¶€, λ¬΄μ‹ν•  μ μ—†μ (λ§¤μ° μ¤‘μ”ν•¨)
       - μ •μ „, ν•λ“μ›¨μ–΄ κ³ μ¥ λ“± μ–΄μ©”μμ—†λ” μ¤λ¥
       - μΈν…” CPUμ—μ„ NMI pinμΌλ΅ μ‹ νΈκ°€ λ“¤μ–΄μ΄
### ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ μΆ…λ¥
- μ…μ¶λ ¥ μΈν„°λ½νΈ (I/O interrupt)
- μ…μ¶λ ¥ μ‘μ—…μ μΆ…λ£λ‚ μ…μ¶λ ¥ μ¤λ¥μ— μν•΄ CPUμ κΈ°λ¥μ΄ μ”μ²­λ¨
- μ •μ „,μ „μ› μ΄μƒ μΈν„°λ½νΈ(Power fail interrupt) μ „μ› κ³µκΈ‰μ μ΄μƒ
- κΈ°κ³„ μ°©μ¤ μΈν„°λ½νΈ(Machine check interrupt) CPUμ κΈ°λ¥μ μΈ μ¤λ¥
- μ™Έλ¶€ μ‹ νΈ μΈν„°λ½νΈ(External interrupt) I/O μ¥μΉκ°€ μ•„λ‹ μ¤νΌλ μ΄ν„°λ‚ νƒ€μ΄λ¨Έμ— μν•΄ μλ„μ μΌλ΅ ν”„λ΅κ·Έλ¨μ΄ μ¤‘λ‹¨λ κ²½μ°

## μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ
  - CPU λ‚΄λ¶€μ—μ„ μμ‹ μ΄ μ‹¤ν–‰ν• λ…λ Ήμ΄λ‚ CPU λ…λ Ή μ‹¤ν–‰μ— κ΄€λ ¨λ λ¨λ“μ΄ λ³€ν™”ν•λ” κ²½μ° λ°μƒ
  - trap λλ” exception μ΄λΌκ³  ν•λ‹¤.
  - ν”„λ΅κ·Έλ¨ μ¤λ¥μ— μν•΄ μƒκΈ°λ” μΈν„°λ½νΈ
### μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ μΆ…λ¥
- ν”„λ΅κ·Έλ¨ κ²€μ‚¬ μΈν„°λ½νΈ(Program check interrupt)
  - 0μΌλ΅ λ‚λ„λ” κ²½μ°
  - OverFlow/UnderFlow
  - νμ΄μ§€ λ¶€μ¬
  - λ¶€λ‹Ήν• κΈ°μ–µμ¥μ†μ μ°Έμ΅°
  - λ“±λ“±
- SVC(Supervisor Call: κ°μ‹ν”„λ΅κ·Έλ¨ νΈμ¶)μΈν„°λ½νΈ
  - μ‚¬μ©μκ°€ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰μ‹ν‚¤κ±°λ‚ supervisiorμ„ νΈμ¶ν•λ” λ™μ‘μ„ μν–‰ν•λ” κ²½μ°
  - ν”„λ΅κ·Έλλ¨Έμ— μν•΄ μ½”λ“λ΅ μ§μΈ κ°μ‹ ν”„λ΅κ·Έλ¨μ„ νΈμ¶ν•λ” λ°©μ‹
#### π± λ¬΄μ¨ λ§μΈμ§€ λ¨λ¥΄κ² λ‹¤
μΌλ°μ μΈ μ‘μ©ν”„λ΅κ·Έλ¨μ€ User Mode μ—μ„ μ‹¤ν–‰λλ”λ°, μ΄ κ²½μ° μ§μ ‘ μ ‘κ·Όν•  μ μλ” μμ›μ— λ€ν• μ ν•μ΄ μλ‹¤. μλ¥Ό λ“¤μ–΄ μ–΄λ–¤ ν”„λ΅κ·Έλ¨μ΄ μ»΄ν“¨ν„°μ— λ€ν• ν†µμ κ¶ μ½”λ“λ¥Ό κ°–κ³  μλ‹¤κ³  ν•  λ•, μ΄λ° κ²ƒμ΄ ν—λ½λ„ μ—†μ΄ μν–‰λ  μλ” μ—†λ‹¤.
μμ›μ— μ ‘κ·Όν•λ” λ…λ Ήμ–΄λ” supervisior λ§ μ‹¤ν–‰ν•  μ μμ–΄μ•Ό ν•κ³ , μ΄κ²ƒμ΄ Kernel Mode κ°€ λλ‹¤.</br>
μ¦‰ μ‘μ©ν”„λ΅κ·Έλ¨μ€ Supervisior Callμ„ ν†µν•΄ ν—λ½μ„ λ§΅μ€ ν›„ Kernel Modeλ΅ λ³€κ²½ν•κ³ , ν•΄λ‹Ή λ…λ Ήμ„ μ‹¤ν–‰ ν›„ λ‹¤μ‹ User Modeλ΅ λ³€κ²½ν•λ” κ³Όμ •μ„ κ±°μΉλ‹¤. </br>
μ΄μμ²΄μ κ°€ μ κ³µν•λ” μ„λΉ„μ¤μ— λ€ν• ν”„λ΅κ·Έλλ° μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ System Callμ΄κ³ , System Callμ„ μ‹¤ν–‰μ‹ν‚¤κΈ° μ„ν• CPU λ…λ Ήμ–΄κ°€ SVCμ΄λ‹¤.


#### π§ User Mode ? Kernel Mode?
##### User Mode
- μ μ €κ°€ μ ‘κ·Όν•  μ μλ” μμ—­μ„ μ ν•μ μΌλ΅ λ‘κ³ , ν”„λ΅κ·Έλ¨μ μμ›μ— ν•¨λ¶€λ΅ μΉ¨λ²”ν•μ§€ λ»ν•λ” λ¨λ“
- μ°λ¦¬κ°€ μ½”λ“λ¥Ό μ‘μ„±ν•κ³ , ν”„λ΅μ„Έμ¤λ¥Ό μ‹¤ν–‰ν•λ” λ“±μ ν–‰λ™μ„ ν•λ” μμ—­μ΄λ‹¤.
  
##### Kernel Mode
- λ¨λ“  μμ›μ— μ ‘κ·Ό, λ…λ Ήμ„ ν•  μ μλ‹¤.

<img width="556" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-07-02 α„‹α…©α„’α…® 12 25 58" src="https://github.com/amazinguss/cs_study/assets/57309311/f134985f-b18f-47e1-9ca0-aa33da99e394">

      
#### π§ System Call?
μ΄μ μ²΄μ μ μ»¤λ„μ΄ μ κ³µν•λ” μ„λΉ„μ¤μ— λ€ν•΄, μ‘μ© ν”„λ΅κ·Έλ¨μ μ”μ²­μ— λ”°λΌ μ»¤λ„μ— μ ‘κ·Όν•κΈ° μ„ν• μΈν„°νμ΄μ¤μ΄λ‹¤.
μ°λ¦¬κ°€ μΌλ°μ μΌλ΅ μ‚¬μ©ν•λ” ν”„λ΅κ·Έλ¨μ€ μ μ €λ λ²¨λ΅ μ μ € λ λ²¨μ ν”„λ΅κ·Έλ¨μ€ μ μ €λ λ²¨μ ν•¨μλ“¤ λ§μΌλ΅ λ§μ€ κΈ°λ¥μ„ κµ¬ν„ν•κΈ° νλ“¤κΈ° λ•λ¬Έμ— μ»¤λ„μ— λ„μ›€μ΄ λ°λ“μ‹ ν•„μ”ν•λ‹¤. λ°λ“μ‹ Kernelμ— κ΄€λ ¨λ κ²ƒμ„ Kernel λ¨λ“λ΅ μ „ν™ν• ν›„μ— μ‘μ—…μ„ μν–‰ν•  κ¶ν•μ΄ μƒκΈ΄λ‹¤. Kernel λ¨λ“λ¥Ό ν†µν• μ‘μ—…μ€ λ°λ“μ‹ **μ‹μ¤ν… μ½** μ„ ν†µν•΄ μν–‰ν•΄μ•Όν•λ‹¤.

##### μ‹μ¤ν… μ½μ μΆ…λ¥
- ν”„λ΅μ„Έμ¤ μ»¨νΈλ΅¤
  - ν”„λ΅μ…‹ μƒμ„± λ° μΆ…λ£
  - λ©”λ¨λ¦¬μ— λ΅λ“ λ° μ‹¤ν–‰
  - λ©”λ¨λ¦¬ ν• λ‹Ή
 - νμΌ λ§¤λ‹μ§€λ¨ΌνΈ
   - νμΌ μƒμ„±, μ‚­μ 
   - μ—΄κΈ° λ° λ‹«κΈ°
   - μ½κΈ° λ° μ“°κΈ°
- λ“±λ“±

# ν”„λ΅μ„Έμ¤ μƒνƒλ΅ λ³΄λ” μΈν„°λ½νΈ κ³Όμ •
<img width="716" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-07-02 α„‹α…©α„α…¥α†« 11 53 21" src="https://github.com/amazinguss/cs_study/assets/57309311/93c111c5-03d8-40c7-b6f9-340d1194032d">

- ν”„λ΅μ„Έμ¤κ°€ μ‹¤ν–‰μ¤‘μ— I/O event κ°€ λ°μƒν•λ©΄ (κ²μ„ λ„μ¤‘ λ΅κ·ΈμΈμ„ ν•΄μ•Όν•λ‹¤λ©΄)
- μ‹¤ν–‰μ¤‘μΈ ν”„λ΅μ„Έμ¤κ°€ Waiting μƒνƒλ΅ κ°€κ²λλ‹¤.
- μ…μ¶λ ¥μ΄ λλ‚λ©΄ μΈν„°λ½νΈκ°€ λ°μƒν•΄μ„ μ™„λ£λμ—λ‹¤κ³  μ‹ νΈλ¥Ό λ³΄λ‚Έλ‹¤.
- ν”„λ΅μ„Έμ¤κ°€ μ‹¤ν–‰ λ€κΈ° μ¤‘μΈ Readyλ΅ κ°€κ² λκ³  CPU μ¤μΌ€μ¥΄λ§μ— μν•΄ μ‹¤ν–‰λλ‹¤.

# μΈν„°λ½νΈ κ³Όμ •
<img width="534" alt="image" src="https://github.com/amazinguss/cs_study/assets/57309311/ffe05abe-65b9-4834-b5bc-0a5a4002907b">

</br>

Process A μ‹¤ν–‰ μ¤‘ λ””μ¤ν¬μ—μ„ μ–΄λ–¤ λ°μ΄ν„°λ¥Ό μ½μ–΄μ¤λΌλ” λ…λ Ήμ„ λ°›μ•λ‹¤κ³  κ°€μ •ν•΄λ³΄μ.</br>
- process Aλ” system callμ„ ν†µν•΄ μΈν„°λ½νΈλ¥Ό λ°μƒμ‹ν‚¨λ‹¤.
- CPUλ” ν„μ¬ μ§„ν–‰ μ¤‘μΈ κΈ°κ³„μ–΄ μ½”λ“λ¥Ό μ™„λ£ν•λ‹¤.
- ν„μ¬κΉμ§€ μν–‰μ¤‘μ΄μ—λ μƒνƒλ¥Ό ν•΄λ‹Ή processμ PCB(Process Control Block)μ— μ €μ¥ν•λ‹¤. (μν–‰μ¤‘μ΄λ MEMORYμ£Όμ†, λ μ§€μ¤ν„° κ°’, ν•λ“μ›¨μ–΄ μƒνƒ λ“±...)
- PC(Program Counter, IP)μ— λ‹¤μμ— μ‹¤ν–‰ν•  λ…λ Ήμ μ£Όμ†λ¥Ό μ €μ¥ν•λ‹¤.
- μΈν„°λ½νΈ λ²΅ν„°λ¥Ό μ½κ³  ISR μ£Όμ†κ°’μ„ μ–»μ–΄ ISR(Interrupt Service Routine)λ΅ μ ν”„ν•μ—¬ λ£¨ν‹΄μ„ μ‹¤ν–‰ν•λ‹¤.
- ν•΄λ‹Ή μ½”λ“λ¥Ό μ‹¤ν–‰ν•λ‹¤.
- ν•΄λ‹Ή μΌμ„ λ‹¤ μ²λ¦¬ν•λ©΄, κΈ°μ΅΄ μν–‰μ¤‘μ΄λ λ μ§€μ¤ν„°λ¥Ό λ³µμ›ν•λ‹¤.
- ISRμ λμ— IRET λ…λ Ήμ–΄μ— μν•΄ μΈν„°λ½νΈκ°€ ν•΄μ  λλ‹¤.
- IRET λ…λ Ήμ–΄κ°€ μ‹¤ν–‰λλ©΄, λ€ν”Όμ‹ν‚¨ PC κ°’μ„ λ³µμ›ν•μ—¬ μ΄μ „ μ‹¤ν–‰ μ„μΉλ΅ λ³µμ›ν•λ‹¤.

> IRET Interrupt Return
> μ΄μ „ ν…μ¤ν¬λ΅ λ‹¤μ‹ λμ•„κ°€λ” μ–΄μ…λΈ”λ¦¬ λ…λ Ήμ–΄λ΅ ISRμ λ§μ§€λ§‰ λ…λ Ήμ–΄

> ISR Interrupt Service Routine
> μΈν„°λ½νΈ ν•Έλ“¤λ¬ Interrupt handler λΌκ³ λ„ ν•¨
> μΈν„°λ½νΈκ°€ μ ‘μλλ©΄ κ°κ°μ μΈν„°λ½νΈμ— λ€μ‘ν•μ—¬ νΉμ • κΈ°λ¥μ„ μ²λ¦¬ν•λ” κΈ°κ³„μ–΄ μ½”λ“ λ£¨ν‹΄(μ»¤λ„μ΄ μ‹¤ν–‰)
> ex) ν‚¤λ³΄λ“ μνμ„ λλ¬ ν‚¤λ³΄λ“ μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄ μ΄μ— ν•΄λ‹Ήν•λ” μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄μ΄ μ‹¤ν–‰λ¨

> μΈν„°λ½νΈ λ²΅ν„° Interrupt Vector
> μ—¬λ¬κ°€μ§€ μΈν„°λ½νΈμ— λ€ν•΄ ν•΄λ‹Ή μΈν„°λ½νΈ λ°μƒμ‹ μ²λ¦¬ν•΄μ•Ό ν•  λ£¨ν‹΄(ISR)μ μ£Όμ†λ¥Ό λ³΄κ΄€ν•κ³  μλ” κ³µκ°„
> λ€λ¶€λ¶„μ CPUλ“¤μ€ μΈν„°λ½νΈ λ²΅ν„° ν…μ΄λΈ”μ„ κ°€μ§€κ³  μμ
> μΈν…”x86μ—μ„λ” μ΄λ¥Ό IDT(Interrupt Descriptor Table)μ΄λΌκ³  ν•λ‹¤.
   
> PC (Program Counter)
> λ μ§€μ¤ν„°μ κµ¬μ„±μ”μ†λ΅, λ‹¤μλ²μ— μ‹¤ν–‰ν•  λ…λ Ήμ–΄ μ£Όμ†λ¥Ό κΈ°μ–µν•λ‹¤.

# μΈν„°λ½νΈ μ°μ„ μμ„
<img width="590" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-07-02 α„‹α…©α„α…¥α†« 11 17 00" src="https://github.com/amazinguss/cs_study/assets/57309311/b96c56ce-4d9d-4092-ab2e-7f56ece5abd1">
<img width="578" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2023-07-02 α„‹α…©α„α…¥α†« 11 17 21" src="https://github.com/amazinguss/cs_study/assets/57309311/dec9a89d-b46d-480e-bf9f-8ebe4506967d">


> μ¶μ² </br>
> https://medium.com/@lazypanda43/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8-%EC%A2%85%EB%A5%98%EC%99%80-%EC%B2%98%EB%A6%AC%EA%B3%BC%EC%A0%95%EA%B3%BC-%EC%9A%B0%EC%84%A0%EC%88%9C%EC%9C%84-c95c26909472 </br>
> https://doh-an.tistory.com/31</br>
> https://fjvbn2003.tistory.com/306</br>
> https://velog.io/@adam2/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8
