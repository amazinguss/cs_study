# PCB
Process Control Block의 약자로, 프로세스 제어 블록이다. 하나의 PCB 안에는 하나의 프로세스 정보가 담겨있다.</br>
<img width="546" alt="image" src="https://github.com/amazinguss/cs_study/assets/57309311/f8dfdfe3-80d0-4e9d-b430-5a63a4177410">

프로세스들은 여러개가 동시에 실행되는 것 같지만 time sharing을 통해서 빠른 속도로 왔다갔다 하면서 프로세스들을 처리해주고
여러개가 동시에 돌아가는 것 처럼 보이게 한다. 이때 프로세스가 교체되는 과정에서 프로세스의 작업을 저장하는 곳이 PCB이다.
> 프로세스란 프로세서에 의해 수행되는 프로그램 단위로 현재 실행 중이거나, 곧 실행 가능한 PCB를 가진 프로그램이다.
## PCB란?
* 운영체제가 프로세스를 제어하기 위해 정보를 저장해 놓는 곳으로, 프로세스의 상태 정보를 저장하는 구조체
* 프로세스가 생성되면 운영체제는 프로세스에 대한 PCB를 생성
* 프로세스의 중요한 부분을 포함하고 있기 때문에 주기억장치에서 관리


## PCB의 구조
* 프로세스 ID: 프로세스 ID
* 프로세스 스케줄링 상태: '준비','일시중단' 등 프로세스가 CPU에 대한 소유권을 얻은 이후의 상태
* 프로그램 권한: 컴퓨터 자원 또는 I/O 디바이스에 대한 권한 정보
* 프로그램 카운터: 프로세스에서 실행해야 할 다음 명령어의 주소에 대한 포인터
* CPU 레지스터: 프로세스를 실행하기 위해 저장해야 할 레지스터에 대한 정보
* CPU 스케줄링 정보: CPU 스케줄러에 의해 중단된 시간 등에 대한 정보
* 계정 정보: 프로세스 실행에 사용된 CPU 사용량, 실행한 유저의 정보
* I/O 상태 정보: 프로세스에 할당된 I/O 디바이스 목록

## PCB 관리 방식
* Linked List 방식으로 관리가 된다.
* PCB List Head에 PCB들이 생성될 때마다 붙게 된다. 주솟값으로 연결이 이루어져있는 연결 리스트 형태로 삽입, 삭제가 용이하다.
* 프로세스가 생성되면 PCB가 생성되고 프로세스 완료 시 제거된다.

---
</br>

# 문맥 교환 Context Swithing
* PCB 교환 과정으로 현재 진행하고 있는 프로세스의 상태를 PCB에 저장하고 다음 진행할 프로세스의
정보를 PCB에서 읽어 적용하는 과정이다.
* 한 프로세스에 할당된 시간이 끝나거나 인터럽트에 의해 발생

> Context란
> CPU가 다루는 Task(Process/Thread)에 대한 정보를 말하고, 정보는 레지스터에 저장돠고 PCB로 관리된다.

## Context Swithing이 필요한 이유
CPU는 한번에 하나의 프로세스만 수행할 수 있다. 하지만 실생활에서 여러 개의 프로세스를 동시에 수행하려고 한다.
하지만 컴퓨터는 동시에 수행할 수는 없고 **동시에 수행하는 것 처럼** 보이기 위해 여러개의 프로세스를 번갈아가며 수행한다.
이렇게 CPU가 프로세스를 바꿔가며 실행하기 위해서 문맥 교환이 필요하다. 

## Context Swithing 과정
<img width="529" alt="image" src="https://github.com/amazinguss/cs_study/assets/57309311/d2f5ba76-8c6e-4219-96d6-b203db266205"></br>
1. Process P1 이 실행되는 도중 인터럽트나 시스템 콜이 발생한다.</br>
2. PCB1에 P1의 정보를 저장하고 PCB2의 상태를 불러온다.</br>
3. Process P2를 실행한다.</br>
4. P2가 실행되는 도중 인터럽트나 시스템 콜이 발생한다.</br>
5. PCB2에 P2의 정보를 저장하고 PCB1의 상태를 불러온다.</br>
6. Process P1을 실행한다.</br>

## Context Swithing의 Cost
Context Switching이 발생하면 Cost가 발생한다.
* 캐시 초기화
* 메모리 매핑 초기화
* 메모리 접근을 위해 커널은 항상 실행되어야 한다.

  > 커널
  > 컴퓨터와 전원을 켜면 운영체제는 이와 동시에 수행된다. 운영체제도 소프트웨어로써 메모리에 올라가야하는데
  > 규모가 너무 크기 때문에 운영체제 전부 다 올라가면 메모리 낭비가 심하다
  > 그래서 필요한 부분만 올라가게 되는데, 이때 메모리에 상주하는 운영체제의 부분을 커널이라고 한다.
  > 메모리에 올라가있는 커널을 좁은 의미에서 운영체제라고 한다.
  > 커널은 메모리에 상주하는 부분으로 운영체제의 핵심 부분이다.

## Context Swithing 발생시기
* CPU 스케쥴링에 의해 할당된 작업시간이 끝나 timeout이 발생했을 때
* 프로세스의 작업이 끝났을 때
* 실행 중이던 프로세스가 입출력 요청을 할 때

## Process vs Thread
Context Swithing 비용은 Process가 더 많이 든다. Thread는 Stack 영역을 제외한 모든 메모리를 공유하고 Stack 영역만 변경을 진행하면 되기 때문이다.
  
